/**
 * modern-modal-fixes.css - Solution unifiée pour tous les modaux de l'application
 * v2.1.0 - Optimisé et consolidé pour résoudre les problèmes de visibilité des éléments de formulaire
 */

/* ===== STYLES DE BASE POUR LES MODAUX PORTAL ===== */
/* Structure de base de l'environnement du portal */
#portal-modal-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%; 
    z-index: 99999;
    pointer-events: none;
}

/* Backdrop du portal (fond semi-transparent) */
#portal-modal-container .portal-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 999999;
    pointer-events: auto;
}

/* Modal en lui-même */
#portal-modal-container .portal-modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: auto;
    max-width: 90vw;
    max-height: 90vh;
    background-color: white;
    border-radius: 6px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
    z-index: 1000000;
    pointer-events: auto;
    overflow: auto;
}

/* Contenu du modal */
#portal-modal-container .modal-content {
    border: none;
    border-radius: 0.5rem;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.5);
    background-color: #fff;
}

/* En-têtes des modaux */
#portal-modal-container .modal-header {
    position: relative;
    z-index: auto;
    border-bottom: 1px solid #dee2e6;
    padding: 1rem 1rem;
}

/* Corps des modaux */
#portal-modal-container .modal-body {
    position: relative;
    z-index: auto;
    padding: 1rem;
}

/* Pieds des modaux */
#portal-modal-container .modal-footer {
    position: relative;
    z-index: auto;
    border-top: 1px solid #dee2e6;
    padding: 0.75rem;
}

/* ===== FIXES UNIVERSELS POUR BOOTSTRAP MODALS ===== */
/* Ces règles s'appliquent à TOUS les modaux Bootstrap, même sans portal */
.modal-open {
    overflow: hidden;
    padding-right: 0 !important; /* Éviter le décalage */
}

.modal {
    z-index: 1050 !important;
}

.modal-dialog {
    z-index: 1060 !important;
}

.modal-backdrop {
    z-index: 1040 !important;
}

.modal-content {
    position: relative !important;
    display: flex !important;
    flex-direction: column !important;
    width: 100% !important;
    background-color: #fff !important;
    border-radius: 0.5rem !important;
    outline: 0 !important;
    z-index: 1050 !important;
}

/* ===== FIXES POUR LES CONTRÔLES DE FORMULAIRE ===== */
/* Correction critique pour les selects dans n'importe quel modal */
.modal select,
.modal .form-select,
#portal-modal-container select,
#portal-modal-container .form-select {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    z-index: 1056 !important;
    position: relative !important;
    pointer-events: auto !important;
    -webkit-appearance: listbox !important;
    appearance: listbox !important;
    width: 100% !important;
}

/* Correction pour les inputs dans n'importe quel modal */
.modal input:not([type="hidden"]),
.modal textarea,
.modal .form-control,
#portal-modal-container input:not([type="hidden"]),
#portal-modal-container textarea,
#portal-modal-container .form-control {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    position: relative !important;
    z-index: 1055 !important;
    pointer-events: auto !important;
    width: 100% !important;
}

/* Correction pour les boutons dans n'importe quel modal */
.modal button:not(.btn-close),
.modal .btn:not(.btn-close),
#portal-modal-container button:not(.btn-close),
#portal-modal-container .btn:not(.btn-close) {
    position: relative !important;
    z-index: 1057 !important; 
    pointer-events: auto !important;
    opacity: 1 !important;
    visibility: visible !important;
}

/* Bouton de fermeture spécifique */
.modal .btn-close,
.modal [data-portal-dismiss="modal"],
.modal [data-bs-dismiss="modal"],
#portal-modal-container .btn-close,
#portal-modal-container [data-portal-dismiss="modal"] {
    position: relative !important;
    z-index: 1060 !important;
    pointer-events: auto !important;
    opacity: 1 !important;
    visibility: visible !important;
}

/* Corrections pour les labels et autres textes */
.modal label,
.modal .form-label,
.modal .invalid-feedback,
.modal .form-text,
#portal-modal-container label,
#portal-modal-container .form-label,
#portal-modal-container .invalid-feedback,
#portal-modal-container .form-text {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    position: relative !important;
    z-index: 1054 !important;
}

/* ===== CORRECTIONS POUR LES ONGLETS DANS LES MODAUX ===== */
/* Onglets et contenu d'onglets */
.modal .nav-tabs,
.modal .nav-pills,
.modal .tab-content,
.modal .tab-pane,
#portal-modal-container .nav-tabs,
#portal-modal-container .nav-pills,
#portal-modal-container .tab-content,
#portal-modal-container .tab-pane {
    position: relative !important;
    visibility: visible !important;
    opacity: 1 !important;
    z-index: 1053 !important;
}

/* Réparation spécifique pour les onglets actifs */
.modal .tab-pane.active,
#portal-modal-container .tab-pane.active {
    display: block !important;
}

/* Réparation spécifique pour les boutons d'onglets */
.modal .nav-link,
#portal-modal-container .nav-link {
    z-index: 1058 !important;
    position: relative !important;
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto !important;
}

/* ===== STYLES SPÉCIFIQUES POUR LES THÈMES ===== */
/* Badges de thème dans les modaux */
.modal .theme-badge,
#portal-modal-container .theme-badge {
    position: relative !important;
    z-index: 5 !important;
    display: inline-flex !important;
    align-items: center !important;
    visibility: visible !important;
    opacity: 1 !important;
}

/* ===== CORRECTIONS POUR LES TABLEAUX DANS LES MODAUX ===== */
.modal table,
.modal .table,
.modal .table-responsive,
#portal-modal-container table,
#portal-modal-container .table,
#portal-modal-container .table-responsive {
    display: table !important;
    visibility: visible !important;
    opacity: 1 !important;
    position: relative !important;
    z-index: 1052 !important;
}

.modal thead, 
.modal tbody,
#portal-modal-container thead,
#portal-modal-container tbody {
    display: table-row-group !important;
    visibility: visible !important;
    opacity: 1 !important;
}

.modal tr,
#portal-modal-container tr {
    display: table-row !important;
    visibility: visible !important;
    opacity: 1 !important;
}

.modal th, 
.modal td,
#portal-modal-container th,
#portal-modal-container td {
    display: table-cell !important;
    visibility: visible !important;
    opacity: 1 !important;
}

/* ===== AJUSTEMENTS POUR LES APPAREILS MOBILES ===== */
@media (max-width: 576px) {
    #portal-modal-container .portal-modal,
    .modal-dialog {
        width: 90% !important;
        max-height: 80vh !important;
    }
    
    .modal input,
    .modal select,
    .modal textarea,
    #portal-modal-container input,
    #portal-modal-container select,
    #portal-modal-container textarea {
        font-size: 16px !important; /* Empêcher le zoom sur iOS */
    }
}

/* ===== ANIMATIONS LISSES ===== */
/* Animation d'entrée du backdrop */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* Animation d'entrée du modal */
@keyframes slideIn {
    from { 
        opacity: 0;
        transform: translate(-50%, -60%);
    }
    to { 
        opacity: 1;
        transform: translate(-50%, -50%);
    }
}

/* Application des animations */
#portal-modal-container .portal-backdrop {
    animation: fadeIn 0.15s ease-out forwards;
}

#portal-modal-container .portal-modal {
    animation: slideIn 0.2s ease-out forwards;
}
